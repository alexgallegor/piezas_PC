<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Teachable Machine Image Model</title>
        <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
        <style>
            .progress-bar-foto {
              width: 150px;
              height: 5px;
              background-color: #eee;
              margin-right: 10px;
              margin-bottom :15px;
            }
            .progress-bar-fill-foto {
              width: 150px;
              height: 5px;
              background-color: #007bff;
              margin-right: 10px;
              margin-bottom: 15px;
              
            }
            .parrafo {
                line-height: 1;
                margin-bottom: 5px;
                font-size: small;
            }
          </style>
    </head>
    <body>
       <button type="button" onclick="init()">Comenzar</button> 
       <div id="video" style="width: 220px; height: 220px; margin-top: 10px;"></div>  <! -- ESPACIO PARA CAPTURA DE VIDEO 320px320 -->
       <div style="display: flex;">
       <button type="button" style="width: 200px; height: 50px; margin-right: 10px; margin-bottom: 15px;" onclick="hacer_foto('foto1')"> DISCO DURO </button>
       <button type="button" style="width: 200px; height: 50px; margin-right: 10px; margin-bottom: 15px;" onclick="hacer_foto('foto2')"> MEMORIA RAM </button>
       <button type="button" style="width: 200px; height: 50px; margin-right: 10px; margin-bottom: 15px;" onclick="hacer_foto('foto3')"> MICROPROCESADOR </button>
       <button type="button"  style="width: 200px; height: 50px; margin-right: 10px; margin-bottom: 15px;"onclick="hacer_foto('foto4')"> TARJETA GRÁFICA </button>
       <button type="button"  style="width: 200px; height: 50px; margin-right: 10px; margin-bottom: 15px;"onclick="hacer_foto('foto5')"> DISIPADOR/VENTILADOR </button>
       <button type="button"  style="width: 200px; height: 50px; margin-right: 10px; margin-bottom: 15px;"onclick="hacer_foto('foto6')"> FUENTE DE ALIMENTACIÓN </button>
       <button type="button" style="width: 200px; height: 50px; margin-right: 10px; margin-bottom: 15px;"onclick="hacer_foto('foto7')"> PILA </button>
       
      </div>
      
        <div style="display: flex;">
        
        <div id="foto1" style="width: 200px; height: 150px; margin-right: 10px; margin-bottom: 15px;"> </div>
        <div id="foto2" style="width: 200px; height: 150px; margin-right: 10px;margin-bottom: 15px;"> </div>
        <div id="foto3" style="width: 200px; height: 150px; margin-right: 10px;margin-bottom: 15px;"> </div>
        <div id="foto4" style="width: 200px; height: 150px; margin-right: 10px;margin-bottom: 15px;"> </div>
        <div id="foto5" style="width: 200px; height: 150px; margin-right: 10px;margin-bottom: 15px;"> </div>
        <div id="foto6" style="width: 200px; height: 150px; margin-right: 10px;margin-bottom: 15px;"> </div>
        <div id="foto7" style="width: 200px; height: 150px; margin-right: 10px;margin-bottom: 15px;"> </div>
      
        
        </div>

            
        <div style="display: flex;">
          <div class="parrafo" style="flex: 1;">
            
            DISCO DURO
              <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_HD_foto1" ></div></div>
            MEMORIA RAM
              <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_RAM_foto1"></div></div>
            MICROPROCESADOR
              <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_CPU_foto1"></div></div>
            TARJETA GRÁFICA
              <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_GRAFICA_foto1" ></div></div>
            DISIPADOR/VENTILADOR
              <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_VENTILADOR_foto1"></div></div>
            FUENTE DE ALIMENTACIÓN
              <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_FUENTE_foto1" ></div></div>
            PILA
              <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_PILA_foto1"></div></div>
           
          </div> 

          <div class="parrafo" style="flex: 1;">
            
              DISCO DURO
                <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_HD_foto2" ></div></div>
              MEMORIA RAM
                <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_RAM_foto2"></div></div>
              MICROPROCESADOR
                <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_CPU_foto2"></div></div>
              TARJETA GRÁFICA
                <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_GRAFICA_foto2" ></div></div>
              DISIPADOR/VENTILADOR
                <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_VENTILADOR_foto2"></div></div>
              FUENTE DE ALIMENTACIÓN
                <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_FUENTE_foto2" ></div></div>
              PILA
                <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_PILA_foto2"></div></div>
              
               
          </div>     
          <div class="parrafo" style="flex: 1;">
            
            DISCO DURO
              <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_HD_foto3" ></div></div>
            MEMORIA RAM
              <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_RAM_foto3"></div></div>
            MICROPROCESADOR
              <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_CPU_foto3"></div></div>
            TARJETA GRÁFICA
              <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_GRAFICA_foto3" ></div></div>
            DISIPADOR/VENTILADOR
              <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_VENTILADOR_foto3"></div></div>
            FUENTE DE ALIMENTACIÓN
              <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_FUENTE_foto3" ></div></div>
            PILA
              <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_PILA_foto3"></div></div>
           
             
        </div>
        <div class="parrafo" style="flex: 1;">
            
          DISCO DURO
            <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_HD_foto4" ></div></div>
          MEMORIA RAM
            <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_RAM_foto4"></div></div>
          MICROPROCESADOR
            <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_CPU_foto4"></div></div>
          TARJETA GRÁFICA
            <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_GRAFICA_foto4" ></div></div>
          DISIPADOR/VENTILADOR
            <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_VENTILADOR_foto4"></div></div>
          FUENTE DE ALIMENTACIÓN
            <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_FUENTE_foto4" ></div></div>
          PILA
            <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_PILA_foto4"></div></div>
          
           
      </div>  
      <div class="parrafo" style="flex: 1;">
            
        DISCO DURO
          <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_HD_foto5" ></div></div>
        MEMORIA RAM
          <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_RAM_foto5"></div></div>
        MICROPROCESADOR
          <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_CPU_foto5"></div></div>
        TARJETA GRÁFICA
          <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_GRAFICA_foto5" ></div></div>
        DISIPADOR/VENTILADOR
          <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_VENTILADOR_foto5"></div></div>
        FUENTE DE ALIMENTACIÓN
          <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_FUENTE_foto5" ></div></div>
        PILA
          <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_PILA_foto5"></div></div>
      
         
    </div>  
    <div class="parrafo" style="flex: 1;">
            
      DISCO DURO
        <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_HD_foto6" ></div></div>
      MEMORIA RAM
        <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_RAM_foto6"></div></div>
      MICROPROCESADOR
        <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_CPU_foto6"></div></div>
      TARJETA GRÁFICA
        <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_GRAFICA_foto6" ></div></div>
      DISIPADOR/VENTILADOR
        <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_VENTILADOR_foto6"></div></div>
      FUENTE DE ALIMENTACIÓN
        <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_FUENTE_foto6" ></div></div>
      PILA
        <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_PILA_foto6"></div></div>
    
  </div>  
  <div class="parrafo" style="flex: 1;">
            
    DISCO DURO
      <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_HD_foto7" ></div></div>
    MEMORIA RAM
      <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_RAM_foto7"></div></div>
    MICROPROCESADOR
      <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_CPU_foto7"></div></div>
    TARJETA GRÁFICA
      <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_GRAFICA_foto7" ></div></div>
    VENTILADOR/DISIPADOR
      <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_VENTILADOR_foto7"></div></div>
    FUENTE DE ALIMENTACIÓN
      <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_FUENTE_foto7" ></div></div>
    PILA
      <div class="progress-bar-foto" ><div class="progress-bar-fill-foto" id="progressBarFill_PILA_foto7"></div></div>
    
     
                   
      </div>          
              
      <script type="text/javascript">
       // the link to your model provided by Teachable Machine export panel
      const URL = "https://teachablemachine.withgoogle.com/models/rPgKuy0ap7/";

      let model, webcam, labelContainer, maxPredictions;

      const clase = ["HD","RAM","CPU","GRAFICA","VENTILADOR","FUENTE","PILA"]

      // Load the image model and setup the webcam

      async function girarImagen() {
              const canvas = webcam.canvas; // obtiene el canvas de la cámara
              const ctx = canvas.getContext("2d");
              ctx.translate(canvas.width, canvas.height);
              ctx.rotate(Math.PI); // gira 180 grados
              ctx.drawImage(canvas, -canvas.width, -canvas.height );
              ctx.restore(); // restaura el contexto a su estado original
            }
      async function init() 
      {
      //const modelURL = URL + "model.json";
      //const metadataURL = URL + "metadata.json";

      // load the model and metadata
      // Refer to tmImage.loadFromFiles() in the API to support files from a file picker
      // or files from your local hard drive
      // Note: the pose library adds "tmImage" object to your window (window.tmImage)
      // model = await tmImage.load(modelURL, metadataURL);
      // maxPredictions = model.getTotalClasses();
          

      // Convenience function to setup a webcam
      const flip = true; // whether to flip the webcam
      webcam = new tmImage.Webcam(200, 200,  flip); // width, height, flip
      // webcam = new tmImage.Webcam(300, 300, flip, facingMode: "user" }); // width, height, flip, constraints
      await webcam.setup(); // request access to the webcam
      await webcam.play();

      //await(girarImagen()); // llama a
      //await(girarImagen()); // llama a
      
      window.requestAnimationFrame(loop);
  
      // append elements to the DOM
      var existingPhoto = document.querySelector("#video canvas");

// Si no hay una foto presente, entonces añadir una nueva
if (!existingPhoto) {
  document.getElementById("video").appendChild(webcam.canvas);
  labelContainer = document.getElementById("video");
  }
else 
{
document.getElementById("video").removeChild(existingPhoto);
}

/*// Volver a añadir la captura de la webcam
document.getElementById("video").appendChild(webcam.canvas);
}

      // append elements to the DOM
      document.getElementById("video").appendChild(webcam.canvas);
      labelContainer = document.getElementById("video");*/

      
                 
      }

      async function loop() 
      {
                webcam.update(); // update the webcam frame
               // setTimeout(await predict(),3000);
                window.requestAnimationFrame(loop);
      }
      
      async function hacer_foto(elemento)
      {
        const modelURL = URL + "model.json";
        const metadataURL = URL + "metadata.json";
        // load the model and metadata
        // Refer to tmImage.loadFromFiles() in the API to support files from a file picker
        // or files from your local hard drive
        // Note: the pose library adds "tmImage" object to your window (window.tmImage)
        model = await tmImage.load(modelURL, metadataURL);
        maxPredictions = model.getTotalClasses();

        // realiza una predicción de la imagen actual en la cámara
        const prediction = await model.predict(webcam.canvas);
  
        // crea un nuevo elemento de imagen con la foto actual
        const img = new Image();
        img.src = webcam.canvas.toDataURL();
  
        // ajusta el tamaño de la imagen para que sea la mitad del tamaño de la cámara
        const width = webcam.canvas.width / 1.5;
        const height = webcam.canvas.height / 1.5;
  
        // actualiza el elemento de la foto con la nueva imagen         
        const fotoContainer = document.getElementById(elemento);
        fotoContainer.innerHTML = ""; // limpiar el contenedor de la foto
        img.style.width = width + "px";
        img.style.height = height + "px";
        fotoContainer.appendChild(img);           

        setTimeout(await predict_foto(elemento),100);

        }

        async function predict_foto(elemento) 
            {
                // predict can take in an image, video or canvas html element
                const prediction = await model.predict(webcam.canvas);
                for (let i = 0; i < maxPredictions; i++) 
                {
                    const classPrediction =prediction[i].className + ": " + prediction[i].probability.toFixed(2) + " %";   

                    var porcentaje = (parseFloat(prediction[i].probability,2)*100).toFixed(2); // Cambia esto al valor que deseas   
                                                      
                    const progressBarFill = document.getElementById('progressBarFill_'+ clase[i]+ "_"+ elemento);

                    // Obtener el elemento de porcentaje existente (si existe) y eliminarlo
                    const porcentajeElementExistente = progressBarFill.querySelector('span');

                    if (porcentajeElementExistente) {
                      progressBarFill.removeChild(porcentajeElementExistente);
                    }

                    // Crear un elemento span para contener el número del porcentaje
                    const porcentajeElement = document.createElement('span');
                    porcentajeElement.innerHTML = porcentaje + '%';
                    porcentajeElement.style.position = 'relative';
                    porcentajeElement.style.top = '90%';
                    porcentajeElement.style.left = '50%';
                    porcentajeElement.style.transform = 'translate(-50%, -50%)';

                    // Añadir el elemento de porcentaje a la barra de progreso
                    progressBarFill.style.width = porcentaje + '%';
                    progressBarFill.appendChild(porcentajeElement); 
                    
                    /*if (i==0)
                    {
                    var porcentaje = (parseFloat(prediction[i].probability,2)*100).toFixed(2); // Cambia esto al valor que deseas   
                                                      
                    const progressBarFill = document.getElementById('progressBarFill_'+ clase[i]+ "_"+ elemento);

                    // Obtener el elemento de porcentaje existente (si existe) y eliminarlo
                    const porcentajeElementExistente = progressBarFill.querySelector('span');

                    if (porcentajeElementExistente) {
                      progressBarFill.removeChild(porcentajeElementExistente);
                    }

                    // Crear un elemento span para contener el número del porcentaje
                    const porcentajeElement = document.createElement('span');
                    porcentajeElement.innerHTML = porcentaje + '%';
                    porcentajeElement.style.position = 'relative';
                    porcentajeElement.style.top = '90%';
                    porcentajeElement.style.left = '50%';
                    porcentajeElement.style.transform = 'translate(-50%, -50%)';

                    // Añadir el elemento de porcentaje a la barra de progreso
                    progressBarFill.style.width = porcentaje + '%';
                    progressBarFill.appendChild(porcentajeElement);

                    
                    }

                    if (i==1)
                    {
                      var porcentaje = (parseFloat(prediction[i].probability,2)*100).toFixed(2); // Cambia esto al valor que deseas   

                    // Obtén el elemento de la barra de progreso
                    var progressBarFill = document.getElementById('progressBarFill_VEGETAL_FOTO');

                    // Actualiza el ancho de la barra de progreso
                    progressBarFill.style.width = porcentaje + '%';

                    }
                    //const progressBarFill = document.getElementById('progressBarFill_RAM_'+ elemento);
                    const progressBarFill = document.getElementById('progressBarFill_'+ clase[i]+ "_"+ elemento);

                    // Obtener el elemento de porcentaje existente (si existe) y eliminarlo
                      const porcentajeElementExistente = progressBarFill.querySelector('span');
                      if (porcentajeElementExistente) {
                        progressBarFill.removeChild(porcentajeElementExistente);
                      }

                      // Crear un elemento span para contener el número del porcentaje
                      const porcentajeElement = document.createElement('span');
                      porcentajeElement.innerHTML = porcentaje + '%';
                      porcentajeElement.style.position = 'relative';
                      porcentajeElement.style.top = '90%';
                      porcentajeElement.style.left = '50%';
                      porcentajeElement.style.transform = 'translate(-50%, -50%)';

                      // Añadir el elemento de porcentaje a la barra de progreso
                      progressBarFill.style.width = porcentaje + '%';
                      progressBarFill.appendChild(porcentajeElement);

                    
                    */
              
                }
            } 
           
            
                 
            

         
          


           
            

                            
            
           


                       
            
            
            
            
                      
                          
            
            
        </script>
    </body>
</html>
